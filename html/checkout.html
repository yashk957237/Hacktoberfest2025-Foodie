<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checkout - Foodie</title>
  <link rel="icon" href="../imgs/favicon.png" type="image/png" />

  <!-- CSS links -->
  <link rel="stylesheet" href="../css/style.css" />
  <link rel="stylesheet" href="../css/checkout.css" />
  <link rel="stylesheet" href="../css/cursor.css" />

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css"
    integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Razorpay -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>

<body>
  <!-- UNIVERSAL NAVBAR -->
  <header>
    <nav class="navbar flex between wrapper">
      <div class="logo">Foodie.</div>

      <!-- DESKTOP MENU -->
      <ul class="navList flex gap-3 between">
        <li><a href="./index.html#home">Home</a></li>
        <li><a href="./index.html#services">Services</a></li>
        <li><a href="./menu.html">Menu</a></li>
        <li><a href="./aboutUs.html">About Us</a></li>
        <li><a href="./contactUs.html">Contacts</a></li>
      </ul>

      <div class="desktop-action flex gap-2">
        <button class="desktop-action theme-toggle" aria-label="Toggle dark mode">
          <i class="fa-solid fa-moon"></i>
        </button>
        <a href="./checkout.html" class="cart-icon active">
          <i class="fa-solid fa-bag-shopping"></i>
          <span class="cart-value">0</span>
        </a>
        <a href="./signup.html" class="btn">
          Sign in&nbsp;<i class="fa-solid fa-arrow-right-from-bracket"></i>
        </a>
        <a href="#" class="hamberger"><i class="fa-solid fa-bars"></i></a>
      </div>

      <!-- MOBILE MENU -->
      <ul class="mobile-menu">
        <li><a href="./index.html#home">Home</a></li>
        <li><a href="./index.html#services">Services</a></li>
        <li><a href="./index.html#menu">Menu</a></li>
        <li><a href="./aboutUs.html">About Us</a></li>
        <li><a href="./contactUs.html">Contacts</a></li>
        <li>
          <button class="theme-toggle mobile-theme-toggle" aria-label="Toggle dark mode">
            <i class="fa-solid fa-moon"></i><span>Dark Mode</span>
          </button>
        </li>
        <li>
          <a href="./signup.html" class="btn">
            Sign in&nbsp;<i class="fa-solid fa-arrow-right-from-bracket"></i>
          </a>
        </li>
      </ul>
    </nav>
  </header>

  <main class="checkout-container">
    <h5 class="text-center">Checkout</h5>
    <h1>Let’s Wrap Up Your <span>Cravings</span></h1>

    <!-- EMPTY CART MESSAGE -->
    <div id="emptyCartMessage" class="empty-cart" style="display: none">
      <i class="fa-solid fa-cart-shopping"></i>
      <h2>Your cart is empty</h2>
      <p>Add some delicious items to get started!</p>
      <a href="./menu.html" class="btn">Browse Menu</a>
    </div>

    <!-- CHECKOUT CONTENT -->
    <div id="checkoutContent" class="checkout-grid">
      <!-- DELIVERY INFORMATION -->
      <div>
        <div class="checkout-section">
          <h3>
            <i class="fa-solid fa-location-dot"></i> Delivery Information
          </h3>
          <form id="checkoutForm">
            <div class="form-group">
              <label for="fullName">Full Name *</label>
              <input type="text" id="fullName" name="fullName" required />
              <span class="error-message">Please enter your full name</span>
            </div>

            <div class="form-group">
              <label for="email">Email Address *</label>
              <input type="email" id="email" name="email" required />
              <span class="error-message">Please enter a valid email</span>
            </div>

            <div class="form-group">
              <label for="phone">Phone Number *</label>
              <input type="tel" id="phone" name="phone" required />
              <span class="error-message">Please enter a valid phone number</span>
            </div>

            <div class="form-group">
              <label for="address">Delivery Address *</label>
              <textarea id="address" name="address" rows="3" required></textarea>
              <span class="error-message">Please enter your delivery address</span>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="city">City *</label>
                <input type="text" id="city" name="city" required autocomplete="address-level2" autocapitalize="none"
                  spellcheck="false" placeholder="Enter your city" />
                <span class="error-message">Required</span>
                <div id="citySuggestions" class="autocomplete-list" role="listbox" aria-label="City suggestions"></div>
              </div>
              <div class="form-group">
                <label for="zipCode">ZIP Code *</label>
                <input type="text" id="zipCode" name="zipCode" required />
                <span class="error-message">Required</span>
              </div>
            </div>

            <div class="form-group">
              <label for="notes">Delivery Notes (Optional)</label>
              <textarea id="notes" name="notes" rows="2" placeholder="e.g., Ring the doorbell twice"></textarea>
            </div>
          </form>
        </div>

        <!-- PAYMENT METHOD -->
        <div class="checkout-section" style="margin-top: 2rem">
          <h3><i class="fa-solid fa-credit-card"></i> Payment Method</h3>
          <div class="payment-methods">
            <div class="payment-method active" data-method="card">
              <i class="fa-solid fa-credit-card"></i>
              <p>Card</p>
            </div>
            <div class="payment-method" data-method="cash">
              <i class="fa-solid fa-money-bill-wave"></i>
              <p>Cash</p>
            </div>
            <div class="payment-method" data-method="online">
              <i class="fa-solid fa-wallet"></i>
              <p>Online</p>
            </div>
          </div>
        </div>
      </div>

      <!-- ORDER SUMMARY -->
      <div>
        <div class="checkout-section order-summary">
          <h3><i class="fa-solid fa-receipt"></i> Order Summary</h3>
          <div id="orderItems"></div>

          <div class="order-totals">
            <div class="total-row">
              <span>Subtotal:</span>
              <span id="subtotal">₹0.00</span>
            </div>
            <div class="total-row">
              <span>Delivery Fee:</span>
              <span id="deliveryFee">₹29.00</span>
            </div>
            <div class="total-row">
              <span>Tax (10%):</span>
              <span id="tax">₹0.00</span>
            </div>
            <div class="total-row final">
              <span>Total:</span>
              <span id="finalTotal">₹0.00</span>
            </div>
          </div>

          <button class="place-order-btn" id="placeOrderBtn">
            <i class="fa-solid fa-check"></i> Place Order
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer id="contacts">
    <div class="footer-container">
      <div class="flex wrapper gap-4">
        <div class="footer-wrapper">
          <a href="#" class="logo">Foodie.</a>
          <p class="mt-one">
            We will fill your tummy with delicious <br />
            food with fast delivery
          </p>
          <div class="media flex gap-2 mt-one">
            <a href="https://github.com/janavipandole" class="social-media">
              <img src="../imgs/GitHub.png" alt="GitHub social icon" />
            </a>
            <a href="https://www.linkedin.com/in/janavi-pandole-80a7b2290" class="social-media linkdin">
              <img src="../imgs/linkdin.png" alt="LinkedIn social icon" />
            </a>
            <a href="https://www.youtube.com/@JanaviPandole" class="social-media">
              <img src="../imgs/youtube.png" alt="YouTube social icon" />
            </a>
            <a href="https://x.com/JanaviPandole" class="social-media">
              <img src="../imgs/twitter.png" alt="Twitter social icon" />
            </a>
          </div>
        </div>

        <ul class="footer-wrapper">
          <li>
            <h4>Our Menu</h4>
          </li>
          <li class="mt-one"><a href="#" class="footer-link">Special</a></li>
          <li class="mt-one"><a href="#" class="footer-link">Popular</a></li>
          <li class="mt-one"><a href="#" class="footer-link">Category</a></li>
        </ul>

        <ul class="footer-wrapper">
          <li>
            <h4>Company</h4>
          </li>
          <li class="mt-one">
            <a href="#" class="footer-link">Why Foodie</a>
          </li>
          <li class="mt-one">
            <a href="./contactUs.html" class="footer-link">Partner with us</a>
          </li>
          <li class="mt-one">
            <a href="./aboutUs.html" class="footer-link">About us</a>
          </li>
          <li class="mt-one">
            <a href="./contactUs.html" class="footer-link">FAQ's</a>
          </li>
        </ul>

        <ul class="footer-wrapper">
          <li>
            <h4>Support</h4>
          </li>
          <li class="mt-one">
            <a href="./signup.html" class="footer-link">Account</a>
          </li>
          <li class="mt-one">
            <a href="./contactUs.html" class="footer-link">Support center</a>
          </li>
          <li class="mt-one">
            <a href="./contactUs.html" class="footer-link">Feedback</a>
          </li>
          <li class="mt-one">
            <a href="./contactUs.html" class="footer-link">Contacts</a>
          </li>
        </ul>
      </div>
    </div>
  </footer>

  <!-- SUCCESS MODAL -->
  <div class="success-modal" id="successModal">
    <div class="success-content">
      <div class="success-icon">
        <i class="fa-solid fa-check"></i>
      </div>
      <h2>Order Placed Successfully!</h2>
      <p>Your order has been received and is being prepared.</p>
      <p>
        <strong>Order ID: <span id="orderId"></span></strong>
      </p>
      <p>Estimated delivery time: 30-45 minutes</p>
      <a href="./index.html" class="btn" style="margin-top: 1.5rem">Back to Home</a>
    </div>
  </div>

  <script>
    // Get cart data from sessionStorage
    const cartData = JSON.parse(
      sessionStorage.getItem("checkoutCart") || "[]"
    );
    const deliveryFee = 29.0;
    const taxRate = 0.1;
    let selectedPayment = "card";

    const themeToggle = document.querySelector(".theme-toggle");
    const html = document.documentElement;

    // Load saved theme
    const savedTheme = localStorage.getItem("theme") || "light";
    html.setAttribute("data-theme", savedTheme);

    // Update icon based on theme
    function updateThemeIcon() {
      const icon = themeToggle.querySelector("i");
      if (html.getAttribute("data-theme") === "dark") {
        // Animate icon change
        icon.style.transform = "rotate(360deg) scale(0)";
        setTimeout(() => {
          icon.className = "fa-solid fa-sun";
          icon.style.transform = "rotate(0deg) scale(1)";
        }, 250);
      } else {
        // Animate icon change
        icon.style.transform = "rotate(-360deg) scale(0)";
        setTimeout(() => {
          icon.className = "fa-solid fa-moon";
          icon.style.transform = "rotate(0deg) scale(1)";
        }, 250);
      }
    }

    updateThemeIcon();

    themeToggle.addEventListener("click", () => {
      const currentTheme = html.getAttribute("data-theme");
      const newTheme = currentTheme === "dark" ? "light" : "dark";

      html.setAttribute("data-theme", newTheme);
      localStorage.setItem("theme", newTheme);
      updateThemeIcon();
    });

    // Mobile Menu Toggle
    const hamburger = document.querySelector(".hamberger");
    const mobileMenu = document.querySelector(".mobile-menu");

    hamburger.addEventListener("click", (e) => {
      e.preventDefault();
      mobileMenu.classList.toggle("mobile-menu-active");
    });

    document.addEventListener("DOMContentLoaded", () => {
      if (cartData.length === 0) {
        document.getElementById("emptyCartMessage").style.display = "block";
        document.getElementById("checkoutContent").style.display = "none";
      } else {
        displayOrderItems();
        calculateTotals();
      }
      setupEventListeners();
      // Init enhanced checkout features
      if (window.initCityAutocomplete) window.initCityAutocomplete();
      if (window.initPincodeValidation) window.initPincodeValidation();
    });

    function displayOrderItems() {
      const container = document.getElementById("orderItems");
      container.innerHTML = cartData
        .map(
          (item) => `
                <div class="order-item">
                    <img src="${item.image}" alt="${item.name}">
                    <div class="order-item-details">
                        <div class="order-item-name">${item.name}</div>
                        <div class="order-item-quantity">Qty: ${item.quantity
            }</div>
                    </div>
                    <div class="order-item-price">₹${(
              item.quantity *
              parseFloat(item.price.replace(/[₹$]/g, ""))
            ).toFixed(2)}</div>
                </div>
            `
        )
        .join("");
    }

    function calculateTotals() {
      const subtotal = cartData.reduce((sum, item) => {
        return (
          sum + item.quantity * parseFloat(item.price.replace(/[₹$]/g, ""))
        );
      }, 0);
      const tax = subtotal * taxRate;
      const total = subtotal + deliveryFee + tax;

      document.getElementById("subtotal").textContent = `₹${subtotal.toFixed(
        2
      )}`;
      document.getElementById("tax").textContent = `₹${tax.toFixed(2)}`;
      document.getElementById("finalTotal").textContent = `₹${total.toFixed(
        2
      )}`;
    }

    function setupEventListeners() {
      // Payment method selection
      document.querySelectorAll(".payment-method").forEach((method) => {
        method.addEventListener("click", () => {
          document
            .querySelectorAll(".payment-method")
            .forEach((m) => m.classList.remove("active"));
          method.classList.add("active");
          selectedPayment = method.dataset.method;
        });
      });

      // Place order button
      document
        .getElementById("placeOrderBtn")
        .addEventListener("click", (e) => {
          e.preventDefault();
          if (validateForm()) {
            if (selectedPayment !== "card") {
              alert("Currently only Card payment is integrated.");
              return;
            }
            placeOrderRazorpay();
          }
        });
    }

    function validateForm() {
      const form = document.getElementById("checkoutForm");
      const inputs = form.querySelectorAll(
        "input[required], textarea[required]"
      );
      let isValid = true;

      inputs.forEach((input) => {
        const formGroup = input.closest(".form-group");
        if (!input.value.trim()) {
          formGroup.classList.add("error");
          isValid = false;
        } else {
          formGroup.classList.remove("error");
        }
      });

      // Email validation
      const email = document.getElementById("email");
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (email.value && !emailRegex.test(email.value)) {
        email.closest(".form-group").classList.add("error");
        isValid = false;
      }

      // Phone number validation
      const phone = document.getElementById("phone");
      let phoneValue = phone.value.trim();
      if (/^[0-9]{10}$/.test(phoneValue)) {
        phoneValue = "+91 " + phoneValue;
        phone.value = phoneValue;
      }
      const phoneRegex = /^\+91\s?[0-9]{10}$/;

      if (!phoneRegex.test(phone.value)) {
        phone.closest(".form-group").classList.add("error");
        phone.nextElementSibling.textContent = "Enter valid Indian number";
        isValid = false;
      } else {
        phone.closest(".form-group").classList.remove("error");
        phone.nextElementSibling.textContent =
          "Please enter a valid phone number";
      }

      return isValid;
    }

    function placeOrderRazorpay() {
      const totalAmount =
        parseFloat(
          document
            .getElementById("finalTotal")
            .textContent.replace(/[₹$]/g, "")
        ) * 100; // in paise
      const orderId = "FD" + Date.now().toString().slice(-8);
      document.getElementById("orderId").textContent = orderId;

      const options = {
        key: "rzp_test_RS6EdXdKAxfVLe", // Replace with your Razorpay test key
        amount: totalAmount,
        currency: "INR",
        name: "Foodie",
        description: "Order Payment",
        handler: function (response) {
          console.log("Payment Success:", response);
          document.getElementById("successModal").classList.add("active");
          sessionStorage.removeItem("checkoutCart");
        },
        prefill: {
          name: document.getElementById("fullName").value,
          email: document.getElementById("email").value,
          contact: document.getElementById("phone").value,
        },
        theme: { color: "#F2BD12" },
      };

      const rzp = new Razorpay(options);
      rzp.open();
    }
  </script>

  <script src="../js/app.js"></script>
  <script src="../js/cursor.js"></script>
  <script src="../js/checkout.js"></script>
</body>

</html>